<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Rapid Suitability (MCDA-lite) — Strathcona County</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="icon" href="data:,">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet@3.0.12/dist/esri-leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
  <style>
    :root { --panel-w: 320px; --fs: 11px; }
    html, body { height:100%; margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto; font-size:var(--fs); }
    #app { display:grid; grid-template-columns:1fr var(--panel-w); grid-template-rows:100vh; width:100vw; overflow:hidden; }
    #map { min-width:0; height:100%; }
    #panel {
      height:100%; overflow:auto; padding:8px 10px; border-left:1px solid #ddd; background:#fff; line-height:1.32; z-index:10000;
      display:flex; flex-direction:column;
    }
    h2 { font-size:12px; margin:2px 0 8px; }
    .small { color:#555; font-size:10px; }
    .group { margin:8px 0; }
    label { display:block; margin-bottom:4px; font-weight:600; }
    .row { display:flex; gap:6px; align-items:center; }
    input[type="range"] { width:100%; }
    select, input[type="checkbox"] { font-size:var(--fs); }
    .btn { display:inline-block; padding:5px 5px; background:#016797; color:#fff; border-radius:7px; cursor:pointer; text-decoration:none; }
    .badge { font-size:11px; background:#f0f0f0; padding:1px 5px; border-radius:999px; }
    .muted { color:#777; } .ok { color:#0a7; } .warn { color:#d70; } .err { color:#d33; }
    .hr { height:1px; background:#eee; margin:8px 0; }
    .legend { display:flex; height:10px; margin:4px 0 6px; background:linear-gradient(90deg,#fff7bf,#79bcd7,#0b3c73); border:1px solid #ccc; }
    .footer { margin-top:auto; padding-top:8px; border-top:1px dashed #e5e5e5; }
    /* tighter layers list */
    .layers-list label { display:block; margin:0; line-height:1.2; }
    .layers-list label + label { margin-top:2px; }
    .leaflet-control-layers { display: none !important; }
    .npri-label{
      background: rgba(255,255,255,0.9);
      padding: 1px 3px;
      border: 1px solid #bbb;
      border-radius: 3px;
      box-shadow: 0 1px 1px rgba(0,0,0,0.05);
      font-size: 11px;
    }
  </style>
</head>
<body>
  
<div id="app">
  <div id="map"></div>

  <aside id="panel">
    <h2>Rapid Suitability (MCDA-lite)</h2>
    <div class="small">Hex-grid scoring from live ArcGIS GeoJSON. Adjust and click <b>Recompute</b>.</div>

    <div class="group">
      <a id="btnClear" class="btn" style="background:#6c757d">Clear results</a>
    </div>

    <div class="group">
      <label>Objective</label>
      <select id="mode">
        <option value="exposure">Population/Exposure (closer to amenities)</option>
        <option value="background">Background/Regional (farther from amenities)</option>
      </select>
    </div>
    
    <div class="row"><span class="small" style="width:110px">Pop. density</span>
      <input type="range" id="w_pop" min="0" max="1" step="0.05" value="0.15">
      <span id="w_pop_val" class="badge">0.15</span>
    </div>

    <div class="group">
      <label>Roads preference</label>
      <select id="roadsPref">
        <option value="closer">Closer is better (near traffic)</option>
        <option value="farther">Farther is better (background)</option>
      </select>
    </div>

    <div class="group">
      <label>Industry (NPRI) preference</label>
      <select id="industryPref">
        <option value="closer">Closer is better (source-oriented)</option>
        <option value="farther">Farther is better (background)</option>
      </select>
    </div>

    <div class="group">
      <label>Hex cell size (km)</label>
      <div class="row">
        <input type="range" id="cellkm" min="0.3" max="2.5" step="0.1" value="0.6">
        <span id="cellkm_val" class="badge">0.6</span>
      </div>
    </div>

    <div class="group">
      <label>Distance cap for proximity (km) <span class="small">(linear rescale)</span></label>
      <div class="row">
        <input type="range" id="dmax" min="0.5" max="6" step="0.5" value="3">
        <span id="dmax_val" class="badge">3</span>
      </div>
    </div>

    <div class="group">
      <label>Weights (auto-normalize)</label>
      <div class="row"><span class="small" style="width:110px">Wi-Fi proximity</span><input type="range" id="w_wifi" min="0" max="1" step="0.05" value="0.25"><span id="w_wifi_val" class="badge">0.25</span></div>
      <div class="row"><span class="small" style="width:110px">Amenities proximity</span><input type="range" id="w_amen" min="0" max="1" step="0.05" value="0.25"><span id="w_amen_val" class="badge">0.25</span></div>
      <div class="row"><span class="small" style="width:110px">Roads proximity</span><input type="range" id="w_road" min="0" max="1" step="0.05" value="0.20"><span id="w_road_val" class="badge">0.20</span></div>
      <div class="row"><span class="small" style="width:110px">Land-use score</span><input type="range" id="w_lu" min="0" max="1" step="0.05" value="0.20"><span id="w_lu_val" class="badge">0.20</span></div>
      <div class="row"><span class="small" style="width:110px">Bldg density</span><input type="range" id="w_bld" min="0" max="1" step="0.05" value="0.10"><span id="w_bld_val" class="badge">0.10</span></div>
      <div class="group">
        <label>Industry (NPRI) preference</label>
        <select id="industryPref">
          <option value="closer">Closer is better</option>
          <option value="farther">Farther is better</option>
        </select>
      </div>
      <div class="small muted">Sum is normalized to 1.</div>
    </div>

    <div class="group">
      <label><input type="checkbox" id="excludePEMU"> Exclude inside Priority Environmental Mgmt Units</label>
    </div>

    <!-- LAYERS: click on/off -->
    <div class="group">
      <label>Layers (click to show/hide)</label>
      <div class="layers-list small">
        <label><input type="checkbox" id="toggleHex" checked> Suitability hexes</label>
        <label><input type="checkbox" id="toggleTop" checked> Top 10 candidates</label>
        <label><input type="checkbox" id="toggleWifi"> Buildings with Wi-Fi</label>
        <label><input type="checkbox" id="togglePlay"> Playgrounds</label>
        <label><input type="checkbox" id="toggleParks"> Parks</label>
        <label><input type="checkbox" id="toggleFields"> Playing Fields</label>
        <label><input type="checkbox" id="toggleSplash"> Splash Parks</label>
        <label><input type="checkbox" id="toggleRoads"> Roads</label>
        <label><input type="checkbox" id="toggleBldg"> Building footprints</label>
        <label><input type="checkbox" id="togglePEMU"> Priority Env. Mgmt Units</label>
        <label><input type="checkbox" id="toggleLand"> Land-use polygons</label>
        <label><input type="checkbox" id="toggleNPRIwms"> NPRI — Facilities (WMS)</label>
        <label><input type="checkbox" id="togglePA"> PurpleAir sensors</label>
        <label><input type="checkbox" id="toggleStations"> AQ stations</label>
        <label><input type="checkbox" id="toggleCensus"> 2018 Census population density</label>
        <div id="censusStats" class="small panel">Loading…</div>
      </div>
    </div>

    
    <!-- preference, reuse style like Roads -->
    <div class="group">
      <label>Industry (NPRI) preference</label>
      <select id="industryPref">
        <option value="closer">Closer is better (source-oriented)</option>
        <option value="farther">Farther is better (background)</option>
      </select>
    </div>
    
    <!-- weights row (keep with the others) -->
    <div class="row">
      <span class="small" style="width:110px">Industry (NPRI)</span>
      <input type="range" id="w_ind" min="0" max="1" step="0.05" value="0.20">
      <span id="w_ind_val" class="badge">0.20</span>
    </div>


    
    <!-- Land-use score legend/explanation -->
    <div class="group small">
      <b>Land-use score mapping</b>
      <table style="font-size:11px;border-collapse:collapse;margin-top:4px">
        <tr><td>Industrial (IND)</td><td style="padding-left:8px">0.90</td></tr>
        <tr><td>Commercial (COM)</td><td style="padding-left:8px">0.80</td></tr>
        <tr><td>Institutional (INS)</td><td style="padding-left:8px">0.75</td></tr>
        <tr><td>Residential (RES)</td><td style="padding-left:8px">0.60</td></tr>
        <tr><td>Park / Open Space</td><td style="padding-left:8px">0.40</td></tr>
        <tr><td>Agriculture</td><td style="padding-left:8px">0.50</td></tr>
        <tr><td>Default/Other</td><td style="padding-left:8px">0.50</td></tr>
      </table>
    </div>

    <div class="group">
      <a id="runBtn" class="btn">Recompute</a>
      <span id="status" class="small muted">Loading data…</span>
    </div>

    <div class="group">
      <button id="btnExportMCDA" class="btn">Download Top 10 (CSV)</button>
      <span class="small muted" style="display:block;margin-top:4px">
        Exports Top 10 + parameters & component values
      </span>
    </div>

    <div class="group">
      <div class="small"><b>Legend</b> (low → high)</div>
      <div class="legend"></div>
    </div>

    <div class="hr"></div>
    <div class="small">
      Notes: Uses Wi-Fi bldgs, amenities (Playgrounds, Parks, Playing Fields, Splash Parks), Roads, Land-Use, and Building Footprints. Contours are ignored (no slope inference here).
    </div>

    <div class="footer small">
      <b>Land-use score here:</b> <span id="lu_readout">—</span>
    </div>
  </aside>
</div>

<!-- stations data helpers -->
<script src="data.js"></script>
<script src="main.js"></script>


</body>
</html>
